import os
os.mkdir("geoms")
memory 64 GB
set_num_threads(16)

molecule na1t_base {
0 1
C       -4.3007917864      1.0151382143      0.6238921474                 
C       -4.2284127314     -0.1468335626     -0.1260063150                 
C       -1.8782284330      0.2146756262     -0.4715489923                 
C       -1.9364817145      1.3929413095      0.2858457031                 
O       -0.9054661114      3.5137853884      0.5206330404                 
H       -3.2055909037      2.6944597427      1.3920561112                 
C       -3.0184200788     -0.5422237441     -0.6798191312                 
H       -5.1115279090     -0.7513302735     -0.2857176414                 
H       -2.9589422537     -1.4464913335     -1.2723305828                 
C       -3.1589869452      1.7789905864      0.8164434696                 
H       -5.2419730045      1.3284611607      1.0557956326                 
C       -0.7245511497      2.2794927053      0.4774883796                 
C        4.0015725533     -0.6404688681     -0.8987337728                 
H        4.7337137791     -0.2360164453     -1.5854175874                 
C        0.5970100333      0.2397987329      0.4736899331                 
C        0.5281189549      1.6457311874      0.4833169343                 
C        2.1131069236     -1.6858350840      0.8403386707                 
C        4.2437926680     -1.8470127125     -0.2544044842                 
H        1.4098618129      2.2415201202      0.2887490914                 
C        1.8691933472     -0.4673817916      0.2111001976                 
C        2.8218470817      0.0466634928     -0.6673072598                 
H        2.6364495226      0.9816501611     -1.1803735646                 
C        3.2981132708     -2.3691435426      0.6160487389                 
H        5.1669586759     -2.3820832820     -0.4362550896                 
H        1.3708600283     -2.0962886540      1.5141296896                 
H        3.4808673751     -3.3109402495      1.1166916928                 
N       -0.6144487158     -0.2391220615     -0.9835470485                 
H       -0.2852830767      0.3110469292     -1.7688706252                 
H       -0.6418251318     -1.2167100699     -1.2475253978                 
H       -0.0605360811     -0.3064736823      1.1416380603   
}

vecs = [
[2.3815588506078304e-19, 0.0038893807622997333, 0.0],
[0.0034341193817843682, 0.0, 0.001825953664746235],
[0.003247023666302762, 0.0012662585167630934, 0.0017264731082012128],
[-0.0030321474417366943, 0.0018259536647462348, -0.0016122213929596245],
[-0.0033918396736002028, 0.000608433198888124, -0.0018034731451368193],
[-0.0033819473919507364, -0.0006753838816261657, -0.0017982133256831461],
[-0.0030035484879779675, -0.0018856092103639427, -0.0015970150595104587],
[0.0027426096840346523, -0.002340687773510545, 0.0014582714363673332],
[0.0032660416157815073, -0.0012018847531456063, 0.001736585131309923],
[0.0021749141211736545, 0.0, 0.0032244427859192486],
[0.0020564217019029543, 0.0012662585167630936, 0.003048770550043861],
[-0.001920335187965167, 0.0018259536647462341, -0.002847013996138734],
[-0.002148137319278939, 0.0006084331988881245, -0.0031847445445685454],
[-0.0021418722886675477, -0.0006753838816261654, -0.0031754562547175597],
[-0.0019022227517142382, -0.0018856092103639423, -0.0028201612051084305],
[-0.0014553016046793704, -0.00289037318781437, -0.002157573356511593],
[0.0012161965422186239, -0.0032244427859192486, 0.0018030855235334892],
[0.001736963648472581, -0.0023406877735105453, 0.0025751545089509327],
[0.002068466247324551, -0.001201884753145606, 0.0030666273229694],
[0.0004065509941459657, 0.0, 0.0038680743275312304],
[0.0003844015168933799, 0.0012662585167630938, 0.0036573361284796143],
[-0.00035896322165558414, 0.0018259536647462346, -0.003415306916493113],
[-0.0004015456767753325, 0.0006084331988881246, -0.003820451913857974],
[-0.0004003745710297677, -0.0006753838816261654, -0.003809309586980239],
[-0.00035557751143717477, -0.0018856092103639425, -0.0033830940355387804],
[-0.0002720357132286868, -0.00289037318781437, -0.0025882469202221045],
[-0.00015885212873108917, -0.0035801938686214566, -0.0015113770470766667],
[0.00022734043082540124, -0.0032244427859192486, 0.0021629997140528464],
[0.00032468606056999707, -0.0023406877735105453, 0.0030891815134687435],
[0.00038665297218879336, -0.001201884753145606, 0.0036787572947125703],
[-0.0014569876778624858, 1.7842952960914282e-19, 0.0036061710470669766],
[-0.0013776089138382948, 0.0012662585167630934, 0.003409701711790265],
[0.0012864437629938003, 0.001825953664746235, -0.0031840600454453435],
[0.0014390497418155623, 0.0006084331988881247, -0.0035617730973798124],
[0.0014348527612022303, -0.0006753838816261656, -0.003551385205839711],
[0.0012743101361177961, -0.0018856092103639423, -0.0031540282650802877],
[0.0009749150483455103, -0.0028903731878143703, -0.0024129994193576843],
[0.000569290439566176, -0.003580193868621457, -0.0014090432827458261],
[-0.0008147371699050253, -0.0032244427859192486, 0.002016545258221527],
[-0.0011636020972423276, -0.002340687773510545, 0.002880016253492115],
[-0.0013856776251928613, -0.0012018847531456063, 0.003429672473187965],
[-0.002979438520133565, 3.6487598469378973e-19, 0.002500045763359456],
[-0.0028171144656424247, 0.0012662585167630936, 0.0023638397091047397],
[0.002630688069423095, 0.0018259536647462348, -0.002207409388795391],
[0.002942756687855954, 0.0006084331988881246, -0.0024692660514244054],
[0.0029341741542507544, -0.0006753838816261656, -0.0024620644506417166],
[0.0026058756459190536, -0.0018856092103639423, -0.002186589293384535],
[0.001993633503585911, -0.0028903731878143703, -0.0016728571375616075],
[-0.0016660808767860738, -0.0032244427859192486, 0.0013980078492227147],
[-0.002379485402181421, -0.0023406877735105453, 0.001996625323362153],
[-0.0028336144194738154, -0.0012018847531456067, 0.002377684814279102],
[-0.00279778638099368, 3.4263001361819676e-19, -0.002701790902433706],
[-0.0026453589937883125, 0.0012662585167630927, -0.00255459348563631],
[0.002470298750431859, 0.0018259536647462346, 0.0023855397737119893],
[0.0027633409879833245, 0.0006084331988881246, 0.002668527373059786],
[0.002755281719274544, -0.0006753838816261655, 0.0026607446277345636],
[0.002446999105183283, -0.0018856092103639425, 0.0023630395678384515],
[0.001872084497576857, -0.0028903731878143703, 0.001807850984800312],
[-0.0015645022896787694, -0.003224442785919248, -0.0015108222993027536],
[-0.0022344115533882588, -0.0023406877735105453, -0.002157746155406278],
[-0.0026608529688458746, -0.0012018847531456063, -0.002569555843426539],
[-0.0012018847531456063, 1.4718843158837735e-19, -0.0036990209183381728],
[-0.0011364043598287696, 0.0012662585167630932, -0.0034974929898191867],
[0.0010612012496837588, 0.0018259536647462346, 0.0032660416157815077],
[0.0011870875574209803, 0.0006084331988881246, 0.0036534798326601325],
[0.0011836254231249567, -0.0006753838816261657, 0.0036428244789337705],
[0.001051192090811515, -0.001885609210363942, 0.0032352365922994324],
[0.0008042178736457852, -0.00289037318781437, 0.002475128110021722],
[0.00046961378591063477, -0.0035801938686214566, 0.0014453226177277045],
[-0.0006720854247487137, -0.0032244427859192486, -0.0020684662473245525],
[-0.0009598678428465061, -0.0023406877735105457, -0.0029541694577926124],
[-0.0011430603263149206, -0.001201884753145606, -0.003517977948297602],
[0.0006753838816261638, 0.0, -0.00383029232912931],
[0.0006385880057379079, 0.0012662585167630934, -0.003621612547167335],
[-0.0005963285725375399, 0.0018259536647462346, 0.003381947391950737],
[-0.0006670687853080487, 0.0006084331988881245, 0.003783135074552013],
[-0.0006651232828849252, -0.0006753838816261652, 0.003772101582029732],
[-0.0005907040527545435, -0.0018856092103639423, 0.003350049155161351],
[-0.00045192002623751387, -0.0028903731878143703, 0.0025629658287219777],
[-0.0002638935062312567, -0.0035801938686214566, 0.0014966144442045042],
[0.0003776698737238777, -0.0032244427859192486, -0.0021418722886675495],
[0.0005393855507802316, -0.0023406877735105457, -0.0030590074679044195],
[0.0006423282416212776, -0.0012018847531456063, -0.0036428244789337705],
[0.0023945418982206875, 0.0, -0.003064873865563299],
[0.0022640838448185095, 0.0012662585167630934, -0.0028978951717589826],
[-0.0021142550050338034, 0.0018259536647462348, 0.0027061230020153496],
[-0.0023650611139391224, 0.0006084331988881244, 0.0030271401824116194],
[-0.0023581634262803035, -0.0006753838816261653, 0.003018311544811233],
[-0.0020943135337547917, -0.0018856092103639417, 0.002680599082718161],
[-0.0016022612723080997, -0.0028903731878143703, 0.0020508009080777876],
[0.0013390108365483808, -0.003224442785919249, -0.001713855715655953],
[0.001912366190215092, -0.0023406877735105453, -0.002447717102854763],
[0.0022773446758445515, -0.0012018847531456063, -0.0029148682614666918],
[0.0033595467558886634, 0.0012662585167630934, -0.0014957665853568673],
[-0.0031372241622315256, 0.001825953664746235, 0.001396782189268516],
[-0.003499146158719378, -0.0006753838816261657, 0.001557920243949043],
[-0.003107634133886786, -0.0018856092103639423, 0.0013836078598503448],
[0.0033792237576728, -0.0012018847531456063, -0.001504527350992032],
]
ecp = []

set {
    opt_type ts
    geom_maxiter 500
}

set scf {
  maxiter 500
}

set basis def2-tzvpp
optimize('M06-2X', molecule=na1t_base)

set basis sadlej
base, wfn = energy('M06-2X', return_wfn=True, molecule=na1t_base)

with open("efield_perturbation.csv", "w") as f:
  f.write("x, y, z, e_kjmol, dipole(x), dipole(y), dipole(z)\n")
  f.write("0.00000000e-00, 0.00000000e-00, 0.00000000e-00, {}, {}, {}, {}\n".format(0.000000000000000,
          wfn.variable("CURRENT DIPOLE")[0] / 0.3934303,
          wfn.variable("CURRENT DIPOLE")[1] / 0.3934303,
          wfn.variable("CURRENT DIPOLE")[2] / 0.3934303))
with open("geoms/geom_0.xyz", "w") as f:
    f.write(na1t_base.save_string_xyz_file())

set perturb_h true
set perturb_with dipole

for i in range(len(vecs)):
# for vec in vecs:
    na1t = na1t_base
    psi4.set_options({'perturb_dipole': vecs[i]})
    set basis def2-tzvpp
    optimize('M06-2X', molecule=na1t)
    set basis sadlej
    E, wfn = energy('M06-2X', return_wfn=True, molecule=na1t)
    ecp += [E]
    psi4.print_out("-------------------  E-FIELD SCAN REULTS  ---------------------\n")
    psi4.print_out("E-Field                E_int [kj/mol]               \n")
    e = ((ecp[i] - base) * 2625.5)
    psi4.print_out("{:.8e}\t{:.8e}\t{:.8e}\t{}\n".format(
        vecs[i][0], vecs[i][1], vecs[i][2], e))
    with open("efield_perturbation.csv", "a") as f:
      f.write("{:.8e}, {:.8e}, {:.8e}, {}, {}, {}, {}\n".format(
          vecs[i][0], vecs[i][1], vecs[i][2], e, 
          wfn.variable("CURRENT DIPOLE")[0] / 0.3934303,
          wfn.variable("CURRENT DIPOLE")[1] / 0.3934303,
          wfn.variable("CURRENT DIPOLE")[2] / 0.3934303))
    with open("geoms/geom_{}.xyz".format(i+1), "w") as f:
      f.write(na1t.save_string_xyz_file())

psi4.print_out("-------------------  E-FIELD SCAN REULTS  ---------------------\n")
psi4.print_out("\n")
psi4.print_out("E-Field(x)\tE-Field(y)\tE-Field(z)\tE_int\t[kj/mol]\n")
psi4.print_out("---------------------------------------------------------------\n")
for i in range(len(vecs)):
# for vec in vecs:
    e = ((ecp[i] - base) * 2625.5)
    psi4.print_out("{:.8e}\t{:.8e}\t{:.8e}\t{}\n".format(
        vecs[i][0], vecs[i][1], vecs[i][2], e))
